# URL Upload Feature - Документация

## Описание

Новая функция **URL Upload** позволяет загружать документы напрямую по ссылке с автоматическим разбиением файлов `llms-full.txt` на отдельные документы по заголовкам.

## Расположение

Функция доступна в **Explorer** → **Upload Button** → вкладка **"URL Upload"**

## Основные возможности

### 1. Загрузка по URL

- Введите прямую ссылку на текстовый файл (.txt, .md)
- Поддерживаются публичные URL без авторизации
- Файл загружается на клиенте и преобразуется в File объект

### 2. Автоматическое разбиение llms-full.txt

При загрузке файла с именем `llms-full.txt` или `llms.txt` активируется специальная опция:

**"Автоматическое разбиение по заголовкам"** (переключатель)

Когда включено:
- Файл парсится по Markdown заголовкам (`# Header`, `## Header` и т.д.)
- Каждая секция становится отдельным документом
- Сохраняется уровень заголовка (1-6)
- Генерируются уникальные имена файлов: `section_name_part1.txt`, `section_name_part2.txt`

### 3. Настройки загрузки

Все настройки из File Upload доступны и для URL Upload:

#### Collections
- Выбор коллекций для документов
- Создание новой коллекции прямо из диалога
- Если не выбрано - документы попадают в "All Documents"

#### Upload Quality
- **hi-res** (рекомендуется) - Максимальное качество экстракции
- **fast** - Быстрая обработка
- **custom** - Кастомная конфигурация

#### Metadata
- Добавление произвольных ключ-значение пар
- Метаданные применяются ко всем загруженным документам
- Полезно для категоризации и фильтрации

### 4. Предварительный просмотр

Перед загрузкой отображается:
- Количество документов для загрузки
- Название каждого документа
- Размер контента (в символах)
- Уровень заголовка (для разбитых файлов)

## Workflow использования

### Пример 1: Загрузка обычного текстового файла

```text
1. Перейти в Explorer → Upload
2. Выбрать вкладку "URL Upload"
3. Вставить ссылку: https://example.com/document.txt
4. Нажать "Загрузить"
5. Проверить предпросмотр
6. Настроить Collections/Quality/Metadata (опционально)
7. Нажать "Загрузить 1 документ"
```

### Пример 2: Загрузка llms-full.txt с разбиением

```text
1. Перейти в Explorer → Upload
2. Выбрать вкладку "URL Upload"
3. Вставить ссылку: https://developers.cloudflare.com/r2/llms-full.txt
4. Нажать "Загрузить"
5. ВКЛЮЧИТЬ "Автоматическое разбиение по заголовкам"
6. Дождаться парсинга
7. Проверить предпросмотр (например, 150 документов)
8. Настроить метаданные:
   - category: "cloudflare-docs"
   - type: "api-reference"
9. Нажать "Загрузить 150 документов"
```

## Технические детали

### Поддерживаемые форматы URL

- Прямые ссылки на текстовые файлы
- Content-Type должен быть `text/*`
- CORS должен быть настроен на источнике

### Парсинг Markdown заголовков

Regex паттерн: `/^(#{1,6})\s+(.+)$/`

Пример:
```markdown
# Introduction
Текст введения...

## Getting Started
Текст getting started...

### Installation
Текст установки...
```

Результат: 3 отдельных документа с именами:
- `introduction_part1.txt`
- `getting_started_part2.txt`
- `installation_part3.txt`

### Преобразование в File objects

URL контент → Blob → File с правильным MIME type (`text/plain`)

### Интеграция с handleFileUpload

URL-загруженные файлы добавляются в общий `uploadFiles` state и обрабатываются через стандартный `handleFileUpload` pipeline.

## Ограничения

1. **Размер файла** - ограничен браузерным Fetch API
2. **CORS** - URL должен разрешать CORS запросы
3. **Типы файлов** - только текстовые файлы
4. **Авторизация** - не поддерживается (только публичные URL)

## Обработка ошибок

Компонент показывает Alert с ошибкой при:
- Невалидном URL
- HTTP ошибках (404, 500, etc.)
- Неподдерживаемом Content-Type
- Отсутствии заголовков для разбиения

## UI компоненты

Использованы shadcn/ui компоненты:
- `Tabs` - переключение File/URL Upload
- `Input` - ввод URL
- `Switch` - автоматическое разбиение
- `Alert` - сообщения об ошибках
- `Badge` - счётчик документов
- `ScrollArea` - предпросмотр
- `Button` - действия
- `Label` - метки полей

## Расположение файлов

```text
src/
├── components/
│   └── explorer/
│       └── UrlUploadTab.tsx      # Основной компонент
└── pages/
    └── explorer.tsx               # Интеграция в Upload Dialog
```

## Будущие улучшения

- [ ] Поддержка авторизованных URL (Bearer token)
- [ ] Поддержка PDF/DOCX через URL
- [ ] Batch загрузка нескольких URL
- [ ] Кастомные regex паттерны для разбиения
- [ ] Сохранение истории загруженных URL
